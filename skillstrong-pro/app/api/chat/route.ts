import { NextRequest, NextResponse } from 'next/server';import { callGeminiJSON } from '@/lib/gemini';
export const runtime='nodejs';export const dynamic='force-dynamic';
const sysPrompt=`You are a friendly manufacturing career guide for US high-school students. Keep answers under 120 words. Be concrete and practical. Always respond with JSON keys: answer, buttons[], nav[], facts[]. Buttons should be 3â€“6 items. Use actions "search_jobs", "search_training", or "search_web" when the user asks for lists or resources.`;
export async function POST(req:NextRequest){try{const {text}=await req.json();const g=await callGeminiJSON(String(text||''),sysPrompt);return NextResponse.json({answer:String(g.answer||'Here are ways to explore.'),buttons:Array.isArray(g.buttons)?g.buttons.slice(0,8):[],nav:Array.isArray(g.nav)?g.nav.slice(0,6):[],facts:Array.isArray(g.facts)?g.facts.slice(0,6):[]});}catch(e){console.error('chat error',e);return NextResponse.json({answer:'Provider error. Try again.',buttons:[],nav:[],facts:[]});}}